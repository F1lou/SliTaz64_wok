# SliTaz package receipt.

PACKAGE="llvm"
VERSION="13.0.0"
CATEGORY="development"
SHORT_DESC="Modular compiler toolchain collection."
MAINTAINER="nhc1@gmx.net"
LICENSE="MIT"
WEB_SITE="http://llvm.org/"
TARBALL="$PACKAGE-$VERSION.src.tar.xz"
WGET_URL="https://github.com/$PACKAGE/$PACKAGE-project/releases/download/llvmorg-$VERSION/$TARBALL"

DEPENDS="libffi gcc-lib-base"
BUILD_DEPENDS="libffi-dev libffi perl gcc libiconv-dev"

# Rules to configure and make the package.
compile_rules()
{
	cd tools && \
	wget -c https://github.com/$PACKAGE/$PACKAGE-project/releases/download/llvmorg-$VERSION/clang-$VERSION.src.tar.xz --no-check-certificate && \
	tar xf clang-$VERSION.src.tar.xz && mv clang-$VERSION.src clang && cd $src
	mkdir build && cd build
	export LDFLAGS="$LDFLAGS -liconv"
	cmake \
		-DCMAKE_INSTALL_PREFIX=/usr		\
		-DLLVM_ENABLE_FFI=ON			\
		-DCMAKE_BUILD_TYPE=Release		\
		-DLLVM_BUILD_LLVM_DYLIB=ON      \
		-DLLVM_LINK_LLVM_DYLIB=ON       \
		-DLLVM_ENABLE_RTTI=ON           \
		-DLLVM_TARGETS_TO_BUILD="all"	\
		-DLLVM_BUILD_TESTS=ON           \
		-Wno-dev -G Ninja ..            &&
	
	ninja	&&
	
		#~ --sysconfdir=/etc \
		#-DLLVM_ENABLE_PROJECTS="clang"	\
		
	DESTDIR=$DESTDIR ninja install
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	mkdir -p $fs/usr
	cp -a $install/usr/bin $fs/usr
	cp -a $install/usr/lib $fs/usr
	cp -a $install/usr/include $fs/usr
}
