# SliTaz package receipt.

PACKAGE="llvm"
VERSION="14.0.0"
CATEGORY="development"
SHORT_DESC="Modular compiler toolchain collection."
MAINTAINER="nhc1@gmx.net"
LICENSE="MIT"
WEB_SITE="http://llvm.org/"
TARBALL="$PACKAGE-$VERSION.src.tar.xz"
WGET_URL="https://github.com/$PACKAGE/$PACKAGE-project/releases/download/llvmorg-$VERSION/$TARBALL"

DEPENDS="libffi gcc-lib-base"
BUILD_DEPENDS="libffi-dev libffi perl gcc "

# Rules to configure and make the package.
compile_rules()
{
	wget -c https://github.com/$PACKAGE/$PACKAGE-project/releases/download/llvmorg-$VERSION/clang-$VERSION.src.tar.xz && \
	tar xf clang-$VERSION.src.tar.xz && mv clang-$VERSION.src clang
	cd "$src/$PACKAGE-$VERSION.src/"
	mkdir build && cd build
	
	cmake \
		-DLLVM_ENABLE_PROJECTS=clang 		\
		-G "Unix Makefiles" 				\
		-DCMAKE_INSTALL_PREFIX=/usr			\
		-DLLVM_BINUTILS_INCDIR=/usr/include \
		-DCMAKE_BUILD_TYPE=Release			\
		-DLLVM_BUILD_TESTS=OFF				\
		-DLLVM_BUILD_BENCHMARKS=OFF			\
		-DLLVM_INCLUDE_BENCHMARKS=OFF		\
		-DLLVM_ENABLE_FFI=ON				\
		-DLLVM_ENABLE_RTTI=ON  				\
		-DLLVM_BUILD_LLVM_DYLIB=ON			\
		-DLLVM_LINK_LLVM_DYLIB=ON			\
		..	&&
	make && make install
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	mkdir -p $fs/usr
	cp -a $install/usr/bin $fs/usr
	cp -a $install/usr/lib $fs/usr
	cp -a $install/usr/include $fs/usr
}
